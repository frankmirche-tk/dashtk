parameters:
    app.ai.default_provider: '%env(string:AI_DEFAULT_PROVIDER)%'
    app.ai.gemini.default_model: '%env(string:GEMINI_DEFAULT_MODEL)%'
    app.ai.openai.default_model: '%env(string:OPENAI_DEFAULT_MODEL)%'


services:
    _defaults:
        autowire: true
        autoconfigure: true

    App\:
        resource: '../src/'

    # Gemini (wie bisher)
    modelflow.gemini_client_factory:
        class: ModelflowAi\GoogleGeminiAdapter\ClientFactory
        factory: ['ModelflowAi\GoogleGeminiAdapter\ClientFactory', 'create']
        calls:
            - [withApiKey, ['%env(GOOGLE_API_KEY)%']]

    Gemini\Contracts\ClientContract:
        factory: ['@modelflow.gemini_client_factory', 'make']

    # âœ… OpenAI Client
    OpenAI\Client:
        factory: ['OpenAI', 'client']
        arguments:
            - '%env(string:OPENAI_API_KEY)%'

    App\Service\SupportChatService:
        arguments:
            $supportSolutionLogger: '@monolog.logger.support_solution'

    App\Service\ContactResolver:
        arguments:
            $projectDir: '%kernel.project_dir%'

    App\Controller\ContactResolverController:
        arguments:
            $contactLookupLogger: '@monolog.logger.contact_lookup'

    App\AI\GeminiChatAdapterFactory:
        arguments:
            $defaultModel: '%app.ai.gemini.default_model%'
        tags: [ 'app.ai_provider_factory' ]

    App\AI\OpenAiChatAdapterFactory:
        arguments:
            $defaultModel: '%app.ai.openai.default_model%'
        tags: [ 'app.ai_provider_factory' ]

    App\AI\ChatAdapterRegistry:
        arguments:
            $factories: !tagged_iterator app.ai_provider_factory

    App\AI\AiChatGateway:
        arguments:
            $defaultProvider: '%app.ai.default_provider%'

    App\AI\Cost\AiCostCalculator:
        arguments:
            $pricing: '%ai_cost.pricing%'

    App\AI\Cost\AiCostTracker:
        arguments:
            $cache: '@cache.app'
            $calculator: '@App\AI\Cost\AiCostCalculator'
            $enabled: '%ai_cost.enabled%'

    App\AI\Cost\AiCostWindowReader:
        arguments:
            $cache: '@cache.app'

    App\AI\Usage\AiUsageExtractor: ~



